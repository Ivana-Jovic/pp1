package rs.ac.bg.etf.pp1;

import rs.ac.bg.etf.pp1.ast.*;
import rs.etf.pp1.mj.runtime.Code;
import rs.etf.pp1.symboltable.Tab;

public class CodeGenerator extends VisitorAdaptor {
	
	private int mainPC;  
	
	public int getMainPc() {
		return this.mainPC;
	}
	
	
	
//	
	// *************************** METH ***************************
	
	@Override
	public void visit(MethodTypeNameType methodName){
		Code.put(Code.enter);
	}
	
	@Override
	public void visit(MethodTypeNameVoid methodName){
		Code.put(Code.enter);
		Code.put(methodName.obj.getLevel());//b1 form param - level polje
		Code.put(methodName.obj.getLocalSymbols().size());//b2 form param plus lok
	}
	@Override
	public void visit(MethodDecl methodDecl){
		Code.put(Code.exit);
		Code.put(Code.return_);
	}
	// *************************** SIN STMT ***************************
	 @Override
    public void visit(SingleStatementPrintNum ssPrint) {
//			Code.loadConst(0);//width??
//	    	Code.put(Code.print);
	}
	 @Override
    public void visit(SingleStatementPrint ssPrint) {
			Code.loadConst(0);//width??
			if(ssPrint.getExpr().struct.equals(Tab.charType)) {
				Code.put(Code.bprint);
			}
			else {
				Code.put(Code.print);
			}
	}
	 
	// *************************** FACTOR ***************************
	 @Override
	    public void visit(FactorNum factor) {
			Code.loadConst(factor.getVal());
		}
	 @Override
	    public void visit(FactorChar factor) {
			Code.loadConst(factor.getVal());
		}
	 @Override
	    public void visit(FactorBool factor) {
			Code.loadConst((factor.getVal().equals("true"))?1:0);
		}
	 @Override
		public void visit(FactorDes factor) {
		 Code.load(factor.getDesignator().obj);
	 }
	// *************************** EXPR ***************************
	 @Override
		public void visit(ExprAddop exprAddop) {
		 if(exprAddop.getAddop() instanceof AddopPlus) {
			 Code.put(Code.add);
		 }
		 else  if(exprAddop.getAddop() instanceof AddopMinus) {
			 Code.put(Code.sub);
		 } else {}
		}
	// *************************** TERM ***************************
	 @Override
		public void visit(TermMlop termMlop) {
		 if(termMlop.getMulop() instanceof MulopMul) {
			 Code.put(Code.mul);
		 }
		 else  if(termMlop.getMulop() instanceof MulopDiv) {
			 Code.put(Code.div);
		 }
		 else  if(termMlop.getMulop() instanceof MulopMod) {
			 Code.put(Code.rem);
		 } else {}
		}
	 
	 
	 
	// *************************** DESIGN ***************************
		 @Override
			public void visit(DesignatorIdentArr designatorIdentArr) {
		 
	 }
}
